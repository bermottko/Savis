<div class="d-flex justify-content-center align-items-center" style="min-height: 100vh;">
  <div class="card shadow rounded-4 p-5" style="width: 100%; max-width: 400px; background-color: #fff;">
    <form action="/auth/verificarUsuario" method="POST" novalidate>
      <div class="text-center mb-4">
        <img src="/assets/logo.png" alt="Logo" style="width: 50px; height: 70px;">
        <h5 class="mt-2 logo-nome-cadastro">Bem-vindo(a) ao Savis!</h5>
      </div>

      <div class="mb-3">
        <div>
          <input type="radio" id="paciente" name="tipo" value="paciente"
                 style="transform: scale(0.85); margin-right: 3px;"
                 <%= tipoSelecionado === 'paciente' ? 'checked' : '' %>
                 onclick="toggleCampos()" />
          <label for="paciente" style="font-size: 14px;">Paciente</label>
          &nbsp;&nbsp;
          <input type="radio" id="funcionario" name="tipo" value="funcionario"
                 style="transform: scale(0.85); margin-right: 3px;"
                 <%= tipoSelecionado === 'funcionario' ? 'checked' : '' %>
                 onclick="toggleCampos()" />
          <label for="funcionario" style="font-size: 14px;">Funcionário</label>
        </div>
      </div>

      <div class="mb-3 mt-4 <%= tipoSelecionado === 'paciente' ? '' : 'd-none' %>" id="campo-cpf">
        <label for="cpf" class="form-label">CPF</label>
        <input 
          type="text" 
          id="cpf" 
          name="cpf" 
          value="<%= cpf %>"
          class="form-control <%= erroValidacao || camposVazios ? 'is-invalid' : '' %>" 
          placeholder="Digite seu CPF"
        />
      </div>

      <div class="mb-3 mt-4 <%= tipoSelecionado === 'funcionario' ? '' : 'd-none' %>" id="campo-matricula">
        <label for="matricula" class="form-label">Matrícula</label>
        <input 
          type="text" 
          id="matricula" 
          name="matricula" 
          value="<%= matricula %>"
          class="form-control <%= erroValidacao || camposVazios ? 'is-invalid' : '' %>"
          placeholder="Digite sua matrícula"
        />
      </div>
      <div class="mb-3">
        <label for="senha" class="form-label">Senha</label>
        <input 
          type="password" 
          id="senha" 
          name="senha" 
          required 
          class="form-control <%= erroValidacao || camposVazios ? 'is-invalid' : '' %>" 
          placeholder="Digite sua senha"
        />
        <% if (erroValidacao) { %>
          <div class="invalid-feedback">
            <%= erroValidacao %>
          </div>
        <% } %>
      </div>

      <div class="d-flex justify-content-between">
        <a href="#" onclick="window.history.back(); return false;" class="botao-cadastro">Voltar</a>
        <button type="submit" class="botao-cadastro">Entrar</button>
      </div>

      <div class="texto-criar-conta" id="texto-criar-conta" style="display: <%= tipoSelecionado === 'paciente' ? 'block' : 'none' %>;">
        <a>Ainda não tem uma conta Savis?</a>
        <a href="/auth/cadastro/etapa1" class="criar-conta">Criar conta!</a>
      </div>
       <% if (sucesso) { %>
        <script>
          alert('Cadastro realizado com sucesso!');
        </script>
      <% } %>
    </form>
  </div>
</div>

<script>
  function toggleCampos() {
    const pacienteSelecionado = document.getElementById('paciente').checked;
    document.getElementById('campo-cpf').classList.toggle('d-none', !pacienteSelecionado);
    document.getElementById('campo-matricula').classList.toggle('d-none', pacienteSelecionado);

    const textoCriarConta = document.getElementById('texto-criar-conta');
    if (textoCriarConta) textoCriarConta.style.display = pacienteSelecionado ? 'block' : 'none';
  }

  function mascaraCPF(cpfInput) {
    let v = cpfInput.value.replace(/\D/g, '');
    if (v.length > 11) v = v.slice(0, 11);
    v = v.replace(/(\d{3})(\d)/, "$1.$2");
    v = v.replace(/(\d{3})(\d)/, "$1.$2");
    v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
    cpfInput.value = v;
  }

  function mascaraMatricula(matriculaInput) {
    let v = matriculaInput.value.replace(/\D/g, '');
    if (v.length > 4) v = v.slice(0, 4);
    matriculaInput.value = v;
  }

  window.onload = () => {
    toggleCampos();
    const cpfInput = document.getElementById('cpf');
    const matriculaInput = document.getElementById('matricula');
    cpfInput.addEventListener('input', () => mascaraCPF(cpfInput));
    matriculaInput.addEventListener('input', () => mascaraMatricula(matriculaInput));
  };
</script>
