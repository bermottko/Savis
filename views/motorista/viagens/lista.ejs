<div class="col-12 d-flex flex-column align-items-center mt-5">
  <div class="d-flex justify-content-center align-items-center mb-4" style="gap: 10px; width: 100%;">
    <!-- Campo cidade -->
    <input type="search" 
          id="pesquisaCidade" 
          placeholder="Pesquisar por cidade" 
          class="form-control pesquisa-custom"
          style="max-width: 250px;">

    <!-- Campo data -->
    <input type="date" 
          id="pesquisaData" 
          class="form-control pesquisa-custom"
          style="max-width: 200px;">

    <!-- Botão Minhas Viagens -->
    <button id="toggleFiltroMotorista" class="botao-cadastro pesquisa-custom" style="max-width: 200px; height: 38px;">
      Minhas Viagens
    </button>
  </div>

  <% viagens.forEach(function(viagem) { %>
  <div
    class="card shadow-sm mt-2<% if (viagem.Motorista && viagem.Motorista.cod === motorista.cod) { %> minha<% } %>"
    style="width:100%; max-width:700px; border-radius:10px; background-color:#d1e3fd;"
  >
    <!-- Cabeçalho -->
    <div class="card-header d-flex justify-content-between align-items-center" style="background-color:#a7c9f9; border-top-left-radius:10px; border-top-right-radius:10px;">
      <span class="fw-bold" style="color:#062352; font-size:16px"><%= viagem.cidadeconsul.descricao %></span>
      <span class="fw-bold" style="color:#062352; font-size:15px" data-date="<%= viagem.data_viagem %>"><%= viagem.data_viagem.split('-').reverse().join('/') %></span>
    </div>

    <!-- Corpo -->
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center">
        <div class="flex-grow-1">
          <img src="/assets/pessoa-azul.png" alt="Ícone de Usuário" class="mb-1" style="width:20px;height:20px">
          <%= viagem.ocupacao %>/<%= viagem.veiculo.lugares_dispo %> Lugares Ocupados
        </div>
        <button class="botao ver-mais-btn">Ver mais</button>
      </div>

      <div class="detalhes">
        <p><strong>Horário de saída:</strong> <%= viagem.horario_saida.substring(0,5) %></p>
        <hr>
        <p><strong>Modelo do carro:</strong> <%= viagem.veiculo.modelo_veiculo %></p>
        <hr>
        <p><strong>Placa:</strong> <%= viagem.veiculo.placa %></p>
        <hr>
        <p><strong>Motorista:</strong> <%= viagem.Motorista.nome %></p>
        <hr>
        <p><strong>Status:</strong> <%= viagem.status.descricao %></p>
<<<<<<< HEAD
        <% if (viagem.combustivel) { %><hr><p><strong>Combustível:</strong> <%= viagem.combustivel %></p><% } %>
        <% if (viagem.km_inicial) { %><hr><p><strong>Km Inicial:</strong> <%= viagem.km_inicial %></p><% } %>
        <% if (viagem.km_final) { %><hr><p><strong>Km Final:</strong> <%= viagem.km_final %></p><% } %>
        <% if (viagem.paradas) { %><hr><p><strong>Paradas:</strong> <%= viagem.paradas %></p><% } %>
        <% if (viagem.obs) { %><hr><p><strong>Observações:</strong> <%= viagem.obs %></p><% } %>
        <% if (viagem.horario_chega) { %><hr><p><strong>Horário de Chegada:</strong> <%= viagem.horario_chega.substring(0,5) %></p><% } %>
=======
        <hr />

        <% if (viagem.combustivel) { %>
          <p><strong>Combustível:</strong> <%= viagem.combustivel %></p>
          <hr />
        <% } %>
        <% if (viagem.km_inicial) { %>
          <p><strong>Km Inicial:</strong> <%= viagem.km_inicial %></p>
          <hr />
        <% } %>
        <% if (viagem.km_final) { %>
          <p><strong>Km Final:</strong> <%= viagem.km_final %></p>
          <hr />
        <% } %>
        <% if (viagem.paradas) { %>
          <p><strong>Paradas:</strong> <%= viagem.paradas %></p>
          <hr />
        <% } %>
        <% if (viagem.obs) { %>
          <p><strong>Observações:</strong> <%= viagem.obs %></p>
          <hr />
        <% } %>
        <% if (viagem.horario_chega) { %>
          <p><strong>Horário de Chegada:</strong> <%= viagem.horario_chega.substring(0,5) %></p>
          <hr />
        <% } %>

        <a href="/motorista/viagens/participantes/<%= viagem.cod %>" class="botao-visualizar">Participantes</a>
        <br />
>>>>>>> upstream/main

        <a href="/motorista/viagens/participantes/<%= viagem.cod %>" class="botao-visualizar">Participantes</a>
        <div class="d-flex justify-content-end gap-3 mt-2">
          <% if (viagem.Motorista.cod === motorista.cod) { %>
            <a href="/motorista/viagens/relatorio/<%= viagem.cod %>" class="botao">Relatório</a>
          <% } %>
        </div>
      </div>
    </div>
  </div>
  <% }) %>

  <!-- PAGINAÇÃO -->
  <div id="paginacaoWrapper">
    <div id="paginacaoContainer">
      <% if (totalPaginas > 1) { %>
        <% const paginaAnterior = paginaAtual - 1; %>
        <% const proximaPagina = paginaAtual + 1; %>

        <a href="?page=<%= paginaAnterior %>" class="botao-paginacao" <%= paginaAtual === 1 ? 'disabled' : '' %>>«</a>

        <% for (let i = 1; i <= totalPaginas; i++) { %>
          <a href="?page=<%= i %>" class="botao-paginacao <%= paginaAtual === i ? 'ativo' : '' %>"><%= i %></a>
        <% } %>

        <a href="?page=<%= proximaPagina %>" class="botao-paginacao" <%= paginaAtual === totalPaginas ? 'disabled' : '' %>>»</a>
      <% } %>
    </div>
  </div>
</div>

<script>
  // VER MAIS / VER MENOS
  document.querySelectorAll(".ver-mais-btn").forEach(btn => {
    btn.addEventListener("click", function() {
      const card = this.closest(".card");
      const detalhes = card.querySelector(".detalhes");
      const estaExpandido = detalhes.classList.contains("expandido");
      if (estaExpandido) {
        detalhes.style.height = "0px";
        detalhes.style.marginTop = "0";
        detalhes.classList.remove("expandido");
        this.textContent = "Ver mais";
      } else {
        detalhes.style.height = detalhes.scrollHeight + "px";
        detalhes.style.marginTop = "16px";
        detalhes.classList.add("expandido");
        this.textContent = "Ver menos";
      }
    });
  });

  // FILTRO FRONTEND (igual admin + minhas viagens)
  const inputCidade = document.getElementById("pesquisaCidade");
  const inputData = document.getElementById("pesquisaData");
  const botaoFiltroMotorista = document.getElementById("toggleFiltroMotorista");
  const todosCards = Array.from(document.querySelectorAll(".card"));
  let filtroAtivo = false;

  function filtrar() {
    const termoCidade = inputCidade.value.trim().toLowerCase();
    const termoData = inputData.value;

    todosCards.forEach(card => {
      const cidadeText = card.querySelector(".card-header span:first-child")?.textContent.toLowerCase() || "";
      const dataAttr = card.querySelector(".card-header span:last-child")?.getAttribute("data-date") || "";
      let exibir = true;

      if (termoCidade && !cidadeText.includes(termoCidade)) exibir = false;
      if (termoData && dataAttr !== termoData) exibir = false;
      if (filtroAtivo && !card.classList.contains("minha")) exibir = false;

      card.style.display = exibir ? "block" : "none";
    });

    // Esconde paginação quando filtro ativo
    document.getElementById('paginacaoWrapper').style.display = (termoCidade || termoData || filtroAtivo) ? 'none' : 'block';
  }

  inputCidade.addEventListener("input", filtrar);
  inputData.addEventListener("change", filtrar);
  botaoFiltroMotorista.addEventListener("click", () => {
    filtroAtivo = !filtroAtivo;
    botaoFiltroMotorista.textContent = filtroAtivo ? "Todas as Viagens" : "Minhas Viagens";
    filtrar();
  });
</script>
